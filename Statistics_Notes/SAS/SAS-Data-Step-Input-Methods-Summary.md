# SAS编程笔记：DATA步输入方式与处理机制

## 一、三种数据输入方式详解

### 1. 列表输入（List Input）

#### 适用场景

-   数据以固定分隔符（默认空格）分隔
-   变量顺序固定且无缺失值

#### 语法格式

``` sas
input 变量1 变量2<$> ...;
```

#### 示例代码

``` sas
data students;
  input ID $ Name $ Score;
  datalines;
001 John 85
002 Jane 90
003 Mark 87
;
run;
```

#### 输出结果

| ID  | Name | Score |
|-----|------|-------|
| 001 | John | 85    |
| 002 | Jane | 90    |
| 003 | Mark | 87    |

#### 注意事项

-   字符型变量需在变量名后加 `$` 符号
-   数据必须严格按变量顺序排列
-   无法跳过中间变量输入后续值

------------------------------------------------------------------------

### 2. 按列输入（Column Input）

#### 适用场景

-   数据按固定列排列
-   适用于紧凑格式数据（无需分隔符）

#### 语法格式

``` sas
input 变量名<$> 起始列-结束列 ...;
```

#### 示例代码

``` sas
data employees;
  input Name $1-10 DeptID $12-15;
  datalines;
John      D001
Jane      D002
Mark      D003
;
run;
```

#### 输出结果

| Name | DeptID |
|------|--------|
| John | D001   |
| Jane | D002   |
| Mark | D003   |

#### 注意事项

-   必须明确指定列范围（如 `$1-10`）
-   不支持含特殊符号（如逗号、美元符）的数值
-   日期等特殊格式需要额外处理

------------------------------------------------------------------------

### 3. 格式化输入（Formatted Input）

#### 适用场景

-   处理非标准数据（日期、带逗号的数值等）
-   需要精确控制输入格式

#### 语法格式

``` sas
input @列号 变量名 输入格式;
```

#### 示例代码

``` sas
data sales;
  input @1 Name $10. 
        @12 Date date9. 
        @25 Amount comma6.;
  format Date date9.;
  datalines;
Alice     12SEP2023 12,345
Bob       05JAN2024 8,901
;
run;
```

#### 输出结果

| Name  | Date      | Amount |
|-------|-----------|--------|
| Alice | 12SEP2023 | 12345  |
| Bob   | 05JAN2024 | 8901   |

#### 注意事项

-   使用 `@n` 指定读取起始列
-   `date9.` 格式解析日期数据
-   `comma6.` 格式处理含逗号的数值
-   需配合 `format` 语句指定输出格式

------------------------------------------------------------------------

## 二、DATA步处理流程解析

### 编译阶段

1.  检查语法正确性
2.  创建输入缓冲区（Input Buffer）
3.  生成程序数据向量（PDV）

### 执行阶段

1.  **初始化PDV**：将所有变量设置为缺失值
2.  **数据读取**：逐行读取数据到输入缓冲区
3.  **PDV填充**：根据input语句规则填充变量值
4.  **计算语句执行**：执行数据转换/计算操作
5.  **数据写入**：将PDV内容输出到数据集
6.  **循环处理**：重复步骤2-5直至数据读取完毕

#### 带计算的示例

``` sas
data inventory;
  input Product_ID $ Stock Price;
  Cost = Price * 0.15;  /* 计算成本 */
  datalines;
P001 12 100
P002 20 200
;
run;
```

#### 输出结果

| Product_ID | Stock | Price | Cost |
|------------|-------|-------|------|
| P001       | 12    | 100   | 15   |
| P002       | 20    | 200   | 30   |

------------------------------------------------------------------------

## 三、常见问题处理

### 缺失值处理

-   在input语句中使用占位符 `.` 表示缺失值

``` sas
input ID $ Score . Gender $;
```

### 多行观测处理

1.  **行分隔符法**：使用 `/` 分隔不同观测

``` sas
datalines;
001 John 85/
002 Jane 90
;
```

2.  **连续读取法**：通过多个input语句读取同一行

``` sas
input ID $ Name $;
input Score Age;
```

### 复杂数据读取

-   组合使用多种输入方式
-   结合指针控制（`@n`）和格式输入
-   使用 `infile` 语句处理外部文件

------------------------------------------------------------------------

## 关键知识点

-   SAS的三种输入方式及适用场景
-   PDV（程序数据向量）的运行机制
-   多行观测与复杂数据读取技巧
-   数据转换与计算语句的执行时机
