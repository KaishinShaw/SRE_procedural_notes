# SAS方差分析（ANOVA）编程指南

## 1. 基本原理

方差分析通过分解总变异为**组间变异**（处理因素差异）和**组内变异**（随机误差）来检验多组均值差异：

-   **F值** = 组间均方 / 组内均方\
-   **原假设**：所有组均值相等\
-   **前提条件**：
    -   数据独立性
    -   正态性
    -   方差齐性（Homogeneity of variance）

## 2. SAS代码实现（单因素方差分析）

### 案例背景

比较三种教学方法（A/B/C）对学生成绩的影响

### 数据输入

``` sas
DATA class;
  INPUT method $ score;
  DATALINES;
A 85
A 90
B 78
B 82
C 88
C 91
;
RUN;
```

### 方差分析模型

``` sas
PROC ANOVA DATA=class;
  CLASS method;          /* 声明分类变量 */
  MODEL score = method;  /* 构建分析模型 */
  MEANS method / SNK;    /* 多重比较检验 */
RUN;
```

### 结果解读

1.  **F检验**：
    -   若`P值 < 0.05`，拒绝原假设
    -   说明至少存在两组具有显著差异
2.  **SNK多重比较**：
    -   用于确定具体差异组别
    -   输出按均值降序排列的分组字母标记

------------------------------------------------------------------------

## 3. 多因素方差分析扩展

### 案例背景

分析地区与季节对销售额的交互影响

### GLM过程步

``` sas
PROC GLM DATA=sales;
  CLASS region season;          /* 声明分类变量 */
  MODEL sales = region season region*season;  /* 包含交互效应 */
  LSMEANS region season / ADJUST=TUKEY;       /* 校正后均值比较 */
RUN;
```

### 关键要素说明

| 要素            | 描述                         |
|-----------------|------------------------------|
| `region*season` | 交互效应项                   |
| `ADJUST=TUKEY`  | 控制多重比较误差的均值校正法 |

------------------------------------------------------------------------

## 4. 注意事项与进阶处理

### 假设检验

``` sas
/* 方差齐性检验 */
MEANS method / HOVTEST=LEVENE;

/* 非参数替代方案 */
PROC NPAR1WAY DATA=class WILCOXON;
  CLASS method;
  VAR score;
RUN;
```

### 检验策略选择

1.  **正态性不满足**：
    -   使用非参数检验（PROC NPAR1WAY）
    -   考虑数据变换
2.  **方差非齐性**：
    -   使用WELCH校正
    -   选择BROWN-FORSYTHE检验

------------------------------------------------------------------------

## 5. 结果表示示例

### 方差分析表

| 变异来源 | 自由度 | 均方 | F值 | P值  |
|----------|--------|------|-----|------|
| 组间     | 2      | 120  | 4.5 | 0.03 |
| 组内     | 12     | 26.7 | \-  | \-   |

**解读**：\
当`P=0.03 < 0.05`时，表明教学方法对成绩有显著影响（α=0.05水平）

------------------------------------------------------------------------

## 6. 流程总结

1.  数据准备 → 2. 假设检验 → 3. 模型构建 → 4. 结果解读 → 5. 事后检验
