# SAS Proc Tabulate 过程 TABLE 语句布局语法详解

## 目录

1.  [核心概念](#核心概念)\
2.  [示例解析](#示例解析)\
3.  [关键语法规则](#关键语法规则)\
4.  [常见应用场景](#常见应用场景)\
5.  [格式优化建议](#格式优化建议)

------------------------------------------------------------------------

## 核心概念 {#核心概念}

### 1. 维度划分

TABLE 语句通过**逗号**分隔页、行、列三个维度，完整语法结构为：

``` sas
TABLE <页表达式>, <行表达式>, <列表达式>;
```

#### 语法规则说明：

| 语法形式         | 维度分配         | 备注               |
|------------------|------------------|--------------------|
| `TABLE A, B, C;` | 页=A，行=B，列=C | 完整三维表达式     |
| `TABLE , B, C;`  | 无页，行=B，列=C | 页维度需用逗号占位 |
| `TABLE A, , C;`  | 页=A，无行，列=C | 行维度需用逗号占位 |

### 2. 并列元素

同一维度内使用**空格**实现横向并列：

``` sas
/* 行维度并列 */
TABLE Region Sales, Product;  /* 行：Region与Sales并列，列：Product */

/* 列维度并列 */
TABLE Region, Sales Profit;   /* 行：Region，列：Sales与Profit并列 */
```

### 3. 嵌套元素

使用**星号** \* 实现纵向嵌套：

``` sas
/* 行维度嵌套 */
TABLE Region*Sales, Product;  /* 行：Region嵌套Sales，列：Product */
```

------------------------------------------------------------------------

## 示例解析 {#示例解析}

### 示例1：二维表格（行×列）

``` sas
proc tabulate data=sashelp.cars;
  class Origin Make;
  var Weight;
  table Origin Make, Weight*mean; 
run;
```

#### 结构解析：

| 维度 | 组成元素            | 显示方式     |
|------|---------------------|--------------|
| 行   | Origin 与 Make 并列 | 横向平铺显示 |
| 列   | Weight 的均值       | 单列统计量   |

**输出效果**：\
每行显示不同 Origin 和 Make 的组合值，每列显示对应组合的 Weight 均值

### 示例2：三维表格（页×行×列）

``` sas
proc tabulate data=sashelp.cars;
  class Origin Make Type;
  var Weight;
  table Origin, Make, Type*Weight*mean;
run;
```

#### 结构解析：

| 维度 | 组成元素              | 显示方式         |
|------|-----------------------|------------------|
| 页   | Origin                | 按洲生成独立页签 |
| 行   | Make                  | 纵向排列厂商     |
| 列   | Type 嵌套 Weight 均值 | 车型分类横向展开 |

**输出效果**：\
每个 Origin 生成独立分析页，行显示不同厂商，列显示车型与对应 Weight 均值的组合统计

------------------------------------------------------------------------

## 关键语法规则 {#关键语法规则}

### 符号优先级

1.  **逗号 `,`**：维度分隔符（页 \> 行 \> 列）
2.  **空格** ：同维度元素并列
3.  **星号 `*`**：跨维度嵌套

### 统计量绑定规范

必须通过**变量与统计量直接绑定**来生成计算结果：

``` sas
/* 正确写法 */
TABLE Sales*mean;      /* 显示销售额均值 */
TABLE Sales*max*N;     /* 同时显示最大值和样本量 */

/* 错误写法 */
TABLE Sales, mean;     /* 统计量未绑定变量 */
```

------------------------------------------------------------------------

## 常见应用场景 {#常见应用场景}

### 场景1：并列对比分析

``` sas
TABLE Region Sales, Quarter*Profit*mean;
```

➔ 行维度并列显示地区与销售额，列维度显示各季度利润均值

### 场景2：嵌套分类统计

``` sas
TABLE Region*Product, Year*(Sales*sum Profit*mean);
```

➔ 行维度按地区嵌套产品，列维度按年份嵌套销售额总和与利润均值

### 场景3：多维动态钻取

``` sas
TABLE Year, Region*Product, (Sales Inventory)*sum;
```

➔ 页维度按年份切片，行维度按地区嵌套产品，列维度并列显示销售总量与库存总量

------------------------------------------------------------------------

## 格式优化建议 {#格式优化建议}

### 1. 标签优化

``` sas
label 
  Sales = "总销售额"
  mean = "平均值";
```

### 2. 数值格式

``` sas
format 
  Sales dollar12.2
  mean 8.1;
```

### 3. 输出控制

``` sas
proc tabulate data=mydata format=8.1;
  options missing="-";  /* 缺失值显示为横线 */
run;
```

> **提示**：通过 `ods excel` 输出可直接生成交互式多维报表，支持Excel动态筛选

``` sas
ods excel file="输出报表.xlsx";
  proc tabulate ...;
  run;
ods excel close;
```

------------------------------------------------------------------------

**延伸阅读**：可通过 `PROC TEMPLATE` 自定义表格样式，实现企业级标准化报表输出
